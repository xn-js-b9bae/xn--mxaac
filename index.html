<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>αβα</title><meta name="description" content="Documentation for αβα"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">αβα</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>αβα </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#flying_saucer-aba-warning-wip-building_construction" id="flying_saucer-aba-warning-wip-building_construction" style="color: inherit; text-decoration: none;">
  <h1>:flying_saucer: ABA (:warning: WIP :building_construction:)</h1>
</a>
<blockquote>
<p>Test runner for browser libraries.</p>
</blockquote>
<p><strong>ABA</strong> allows you to run tests for browser libraries isolated and in parallel.
This is made possible by <code>playwright</code>, <code>rollup</code>, and some magic glue.</p>
<p>The end goal is to replicate AVA&#39;s experience for browser libraries, with tests
happening in real browsers. The only alternatives I know of are <code>jest</code>&#39;s <code>jsdom</code>
polyfilling, but that is not a real browser, or setting up everything by hand
which is better done once correctly.</p>

<a href="#warning-caveats" id="warning-caveats" style="color: inherit; text-decoration: none;">
  <h2>:warning: Caveats</h2>
</a>
<ul>
<li><p>In its current state, ABA is best suited to test <strong>non-graphical</strong>
libraries, those that do not touch the DOM, but still rely on browser-only
features such as <code>localStorage</code>, and <code>indexeddb</code>.</p>
</li>
<li><p>Tests really run <strong>isolated</strong>. There is no way with the current
implementation to have test functions interact with each other in any way
(<code>localStorage</code>, <code>indexeddb</code>, and cache in general are not shared). This is
counter-intuitive coming from AVA, where disk writes do persist. Browser
contexts provide a real sandbox from which you cannot escape, and those are
discarded once the test function returns or throws. It may be interesting to
provide solutions to this new problem in the future (for instance to test the
behavior of a browser library when running in multiple tabs).</p>
</li>
</ul>

<a href="#woman_teacher-example" id="woman_teacher-example" style="color: inherit; text-decoration: none;">
  <h2>:woman_teacher: Example</h2>
</a>
<p>Install <strong>ABA</strong></p>
<blockquote>
<p>yarn add --dev xn--mxaac</p>
</blockquote>
<p>Declaring tests</p>
<blockquote>
<p>:warning: Currently support is only guaranteed for tests written in
TypeScript and all tests are expected to be <code>async</code>.</p>
</blockquote>
<pre><code class="language-ts"><span class="hl-0">// myTestFile.ts</span><br/><span class="hl-1">import</span><span class="hl-2"> </span><span class="hl-3">test</span><span class="hl-2"> </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;xn--mxaac&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-5">test</span><span class="hl-2">(</span><span class="hl-4">&#39;title&#39;</span><span class="hl-2">, </span><span class="hl-6">async</span><span class="hl-2"> () </span><span class="hl-6">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// do something with the browser API</span><br/><span class="hl-2">    </span><span class="hl-0">// throw an Error to fail the test</span><br/><span class="hl-2">});</span>
</code></pre>
<p>Running tests</p>
<pre><code class="language-shell"><span class="hl-2">aba myTestFile.ts</span>
</code></pre>
<blockquote>
<p>:bulb: Any number of glob expressions is supported, for instance
<code>aba &#39;*.ts&#39;</code> (see <a href="https://github.com/sindresorhus/globby"><code>globby</code></a>).</p>
</blockquote>

<a href="#sparkles-features" id="sparkles-features" style="color: inherit; text-decoration: none;">
  <h2>:sparkles: Features</h2>
</a>
<ul>
<li><input checked="" disabled="" type="checkbox"> Basic browser/device selection</li>
<li><input checked="" disabled="" type="checkbox"> Basic filter/match</li>
<li><input checked="" disabled="" type="checkbox"> Basic timeout</li>
<li><input checked="" disabled="" type="checkbox"> Basic fatal error catching</li>
<li><input checked="" disabled="" type="checkbox"> TAP reporter</li>
</ul>

<a href="#pencil-todo" id="pencil-todo" style="color: inherit; text-decoration: none;">
  <h3>:pencil: TODO</h3>
</a>
<ul>
<li><input disabled="" type="checkbox"> Use proper logger for debugging instead of <code>console.error</code></li>
<li><input disabled="" type="checkbox"> Coverage (using c8/ts-node/babel?)</li>
<li><input disabled="" type="checkbox"> GitHub actions coverage</li>
<li><input disabled="" type="checkbox"> &quot;nice&quot; tasklist-like reporter</li>
<li><input disabled="" type="checkbox"> HTTP polling instead of DOM polling if available</li>
<li><input disabled="" type="checkbox"> Websocket instead of DOM polling if available (see <a href="https://playwright.dev/docs/network#websockets">https://playwright.dev/docs/network#websockets</a> or better <a href="https://masteringjs.io/tutorials/node/websocket-server">https://masteringjs.io/tutorials/node/websocket-server</a>)</li>
<li><input disabled="" type="checkbox"> Multi browser/device matrix run</li>
<li><input disabled="" type="checkbox"> Config file</li>
<li><input disabled="" type="checkbox"> Watch mode (this should be easy through rollup&#39;s watch mechanism)</li>
<li><input disabled="" type="checkbox"> Inspect mode (HTTP server only) to manually open generated HTML files</li>
<li><input disabled="" type="checkbox"> Make parsing grow linearly with test file size (currently sends a test
file containing N tests N times to a browser context, each browser context
reads all the tests code).</li>
</ul>

<a href="#woman_juggling-how-does-it-work" id="woman_juggling-how-does-it-work" style="color: inherit; text-decoration: none;">
  <h2>:woman_juggling: How does it work?</h2>
</a>
<p>A use-once duplex communication channel is established through:</p>
<ol>
<li>Sending arbitrary data to the browser through pointing it to a URL with an
arbitrary location hash.</li>
<li>Sending arbitrary data back to the test runner through writing arbitrary
content to the DOM.</li>
</ol>
<pre><code class="language-ts"><span class="hl-1">import</span><span class="hl-2"> </span><span class="hl-3">test</span><span class="hl-2"> </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;xn--mxaac&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-1">import</span><span class="hl-2"> {</span><span class="hl-3">assert</span><span class="hl-2">} </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;chai&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">myTitle</span><span class="hl-2"> </span><span class="hl-6">of</span><span class="hl-2"> </span><span class="hl-4">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">test</span><span class="hl-2">(</span><span class="hl-3">myTitle</span><span class="hl-2">, </span><span class="hl-6">async</span><span class="hl-2"> () </span><span class="hl-6">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-0">// breaking through abstraction, you are not supposed to do this</span><br/><span class="hl-2">        </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">startEvents</span><span class="hl-2"> = </span><span class="hl-3">document</span><span class="hl-2">.</span><span class="hl-5">querySelector</span><span class="hl-2">(</span><span class="hl-4">&#39;#events&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">            .</span><span class="hl-5">filter</span><span class="hl-2">(({</span><span class="hl-3">type</span><span class="hl-2">}) </span><span class="hl-6">=&gt;</span><span class="hl-2"> </span><span class="hl-3">type</span><span class="hl-2"> === </span><span class="hl-4">&#39;test-start&#39;</span><span class="hl-2">)</span><br/><br/><span class="hl-2">        </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">myStartEvents</span><span class="hl-2"> = </span><span class="hl-3">startEvents</span><br/><span class="hl-2">            .</span><span class="hl-5">filter</span><span class="hl-2">(({</span><span class="hl-3">title</span><span class="hl-2">}) </span><span class="hl-6">=&gt;</span><span class="hl-2"> </span><span class="hl-3">title</span><span class="hl-2"> === </span><span class="hl-3">myTitle</span><span class="hl-2">);</span><br/><br/><span class="hl-2">        </span><span class="hl-5">assert</span><span class="hl-2">(</span><span class="hl-3">myStartEvents</span><span class="hl-2">.</span><span class="hl-3">length</span><span class="hl-2"> === </span><span class="hl-8">1</span><span class="hl-2">);</span><br/><br/><span class="hl-2">        </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">otherStartEvents</span><span class="hl-2"> = </span><span class="hl-3">startEvents</span><br/><span class="hl-2">            .</span><span class="hl-5">filter</span><span class="hl-2">(({</span><span class="hl-3">title</span><span class="hl-2">}) </span><span class="hl-6">=&gt;</span><span class="hl-2"> </span><span class="hl-3">title</span><span class="hl-2"> !== </span><span class="hl-3">myTitle</span><span class="hl-2">);</span><br/><br/><span class="hl-2">        </span><span class="hl-5">assert</span><span class="hl-2">(</span><span class="hl-3">otherStartEvents</span><span class="hl-2">.</span><span class="hl-3">length</span><span class="hl-2"> === </span><span class="hl-8">0</span><span class="hl-2">);</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">}</span>
</code></pre>
<p>In the future we will implement a multi-use duplex communication channel
through websockets or HTTP long-polling.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-type-alias"><a href="modules.html#Test" class="tsd-kind-icon">Test</a></li><li class="tsd-kind-function"><a href="modules.html#default" class="tsd-kind-icon">default</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>